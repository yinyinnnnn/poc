#!/usr/bin/env python3

import os, logging, socket, re
from netifaces import interfaces, ifaddresses, AF_INET

# alternatively if you know the camera's IP address
# you can replace it here
TARGET = '255.255.255.255' 

ips = []
ifaces = interfaces()
for iface in ifaces:
  addrs = ifaddresses(iface)
  if AF_INET in addrs: addrs = addrs[AF_INET]
  else: continue
    
  for addr in addrs:
    ip = addr['addr']
    if ip in ips or ip == '0.0.0.0' or ip[0:3] == '127' or ip[0:7] == '169.254': continue
    ips.append(ip)

for ip in ips:
  s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
  s.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, 1)
  s.settimeout(.5)
  s.bind((ip, 0))

  lanSearch = b'\x22\x11'
  s.sendto(lanSearch, (TARGET, 8600))
  while True:     
      try:
        (buff, rinfo) = s.recvfrom(1024)
        #print('Data from %s: %s' % (rinfo, buff))
        print('IP: ' + buff[4:20].decode('ascii').rstrip('\0'))
        print('Device ID: ' + buff[92:110].decode('ascii').rstrip('\0'))
        print('Username: ' + buff[188:193].decode('ascii').rstrip('\0'))
        print('Password: ' + buff[193:].decode('ascii').rstrip('\0'))

      except socket.timeout as e:
        break
